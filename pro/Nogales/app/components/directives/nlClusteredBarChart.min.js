MetronicApp.directive("nlClusteredBarChart",["$location","$rootScope","$filter","$state",function(n,t,r,u){return this.count=0,{restrict:"E",replace:!0,require:"?ngModel",scope:{nlLocation:"=",nlDashboard:"="},template:'<div class="portlet-body"><div class="chart-back-btn" ng-init="backBtnVisible = false" ng-show="backBtnVisible"><button style="top:0px;height:25.6px" ng-click="backBtnVisible = false" class="btn btn-sm orange chart-back-btn"><i class="fa fa-arrow-circle-o-left"><\/i>Back<\/button><\/div><div id="{{::myId}}" class="chart" style="width:100%;min-height:500px;"><\/div><div id="{{::legendDiv}}" class="clusteredBarChartLegenddiv"  ><\/div><\/div>',link:function(n,t,r,f){function l(){return r.nlDashboard=="casesold"?"No oF Cases Sold":r.nlDashboard=="revenue"?"Revenue":r.nlDashboard=="expenses"?"Expenses":""}function a(){return r.nlDashboard=="casesold"?"":r.nlDashboard=="revenue"?"$":r.nlDashboard=="expenses"?"$":""}n.legendDiv="legenddiv"+count;n.myId="chart_div_clustered"+count++;var e,o,c=l(),h=a(),s=function(f,l,a){function v(n){var u,f,t,r;if(n){for(u=[],f=[],i=0;i<n.length;i++)for(t in n[i])(t=="Column1"||t=="Column2")&&f.indexOf(t)<0&&(r={},r.color=t=="Column1"?n[i].Color1:n[i].Color2,r.title=n[i].Category+" in "+n[i][t],u.push(r),f.push(n[i][t]));return u}}t;e=AmCharts.makeChart(n.myId,{responsive:{enabled:!0},theme:"none",type:"serial",dataProvider:f,valueAxes:[{stackType:"regular",position:"left",title:c}],graphs:[{fillAlphas:0,lineAlpha:0,title:"1200",type:"column",valueField:"Label",showAllValueLabels:!0,labelText:"\n[[Column1]]"},{fillAlphas:.9,lineAlpha:.2,title:"1200",type:"column",valueField:"Val1",fillColorsField:"Color1",columnWidth:.5,balloonText:h+" [[value]]"},{newStack:!0,fillAlphas:0,lineAlpha:0,title:"0100",type:"column",valueField:"Label",showAllValueLabels:!0,labelText:"\n[[Column2]]"},{fillAlphas:.9,lineAlpha:.2,title:"0100",type:"column",valueField:"Val2",fillColorsField:"Color2",columnWidth:.5,balloonText:h+" [[value]]"},],plotAreaFillAlphas:.1,depth3D:30,angle:30,categoryField:"Category",categoryAxis:{title:l,labelOffset:15,gridPosition:"start",tickPosition:"start",labelOffset:34,labelRotation:a},legend:{position:"bottom",data:v(f),autoMargins:!1,equalWidths:!1,divId:n.legendDiv},columnSpacing:12});e.addListener("drawn",function(){e.legend=null});e.addListener("clickGraphItem",function(t){if(r.nlLocation==undefined)if(t.item.dataContext.SubData!=undefined){subChartData=t.item.dataContext.SubData;var i=t.item.dataContext.Category;e.legend=null;s(subChartData,i,35);n.$apply(function(){n.backBtnVisible=!0})}else e.legend=null,s(o,"",0),n.$apply(function(){n.backBtnVisible=!1});else t.item.dataContext.Category&&u.go(r.nlLocation,{category:t.item.dataContext.Category})})};n.$watch(function(){return f.$viewValue},function(t){n.backBtnVisible=!1;o=t;s(o,"",0)});n.$watch("backBtnVisible",function(n,t){!n&&t&&s(o,"",0)})}}}]);