"use strict";MetronicApp.controller("CommodityReportController",["$scope","dataService","$filter","NotificationService","ApiUrl","commonService","$controller",function(n,t,i,r,u,f,e){function s(n){n=n||new Date;var t=Math.floor(n.getMonth()/3)+1;return t>4?t-4:t}function h(){var t=new Date;n.beginDate=i("date")(new Date(t.getFullYear(),t.getMonth(),1),"MM/dd/yyyy");n.endDate=i("date")(new Date,"MM/dd/yyyy");n.search()}n.$on("$viewContentLoaded",function(){Metronic.initAjax()});n.iscanceldisabled=!0;n.commoditylist=[{id:0,com:"All"},{id:1,com:"Produce"},{id:2,com:"Grocery"}];n.Commodityselected=0;n.pageSize=20;e("BaseController",{$scope:n});n.btnSpinner=f.InitBtnSpinner("#search");var o=null;n.myTableFunctions={};n.salesPersonTableFunctions={};n.groupProperty="";n.searchClicked=!1;n.selectedSalesPerson="";n.loadDatePickers=function(){$("#scheduledLoadStartDate").datepicker({rtl:Metronic.isRTL(),orientation:"left",autoclose:!0,todayHighlight:!0});$("#scheduledLoadEndDate").datepicker({rtl:Metronic.isRTL(),orientation:"left",autoclose:!0,todayHighlight:!0})};n.loadDatePickers();n.search=function(r){var l,e,f,a,y,h,v,u,c,p;n.iscanceldisabled=!1;n.CurrentFilter=r;n.searchClicked=!0;n.Prior="";l=!1;u=new Date;r=="ThisMonth"?(e=new Date(u.getFullYear(),u.getMonth(),1),f=new Date(u.getFullYear(),u.getMonth()+1,0)):r=="LastMonth"?(a=u.getMonth(),h=a<12?u.getFullYear():u.getFullYear()-1,e=new Date(h,a-1,1),f=new Date(h,a,0)):r=="ThisQuarter"?(y=s(u),e=new Date(u.getFullYear(),3*y-3,1),f=new Date(u.getFullYear(),3*y,0)):r=="LastQuarter"?(v=s(u)-1,v>0?(h=u.getFullYear(),e=new Date(h,3*v-3,1),f=new Date(h,3*v,0)):(h=u.getFullYear()-1,e=new Date(h,9,1),f=new Date(h,12,0))):r=="YTD"?(e=new Date(u.getFullYear(),0,1),f=new Date):r=="LastYear"?(e=new Date(u.getFullYear()-1,0,1),f=new Date(u.getFullYear(),0,0)):r=="MTD"?(u=new Date,e=new Date(u.getFullYear(),u.getMonth(),1),f=new Date):(e=n.beginDate,f=n.endDate);n.beginDate=i("date")(e,"MM/dd/yyyy");n.endDate=i("date")(f,"MM/dd/yyyy");(n.beginDate||f)&&(l=!n.beginDate||!n.endDate?!0:n.beginDate.length+n.endDate.length<20?!0:l,!l&&n.isDate(n.beginDate)&&n.isDate(n.endDate)&&!n.isPreviouseDate(n.beginDate,n.endDate)&&(n.btnSpinner.start(),c=n.Commodityselected,(n.Commodityselected==0||n.Commodityselected==undefined)&&(c=""),n.Commodityselected==1&&(c="01"),n.Commodityselected==2&&(c="02"),p={comodity:c,startDate:n.beginDate,endDate:n.endDate},(o=t.GetComodityExpenseReport(p)).then(function(t){var r,i;if(t.data.length>0)for(n.iscanceldisabled=!0,n.CurrentLabel="Current Expense ("+t.data[0].CurrentLabel+")",n.PriorLabel="Prior Expense ("+t.data[0].PriorLabel+")",n.salesReport=t.data,n.salesReportMaster=t.data,n.TotalCurrentExpense=0,n.TotalPriorExpense=0,n.TotalPriorRevenue=0,r=n.salesReport.length,i=0;i<r;i++)n.TotalCurrentExpense=n.TotalCurrentExpense+n.salesReport[i].CurrentExpense,n.TotalPriorExpense=n.TotalPriorExpense+n.salesReport[i].PriorExpense,n.TotalPriorRevenue=n.TotalPriorRevenue+n.salesReport[i].PriorRevenue;else n.iscanceldisabled=!0,n.CurrentLabel="Current Expense",n.PriorLabel="Prior Expense",n.salesReport=[],n.salesReportMaster=[];n.btnSpinner.stop()}).catch(function(t){var i=t;n.btnSpinner.stop()})))};n.resetSearch=function(){n.myTableFunctions.resetSearch();n.groupProperty="";n.selectedSalesPersons=[];n.salesReport=[];n.salesReportMaster=[];n.Commodityselected=0;n.CurrentFilter="MTD";h()};n.abortExecutingApi=function(){n.iscanceldisabled=!0;try{return o&&o.abortCall()}catch(t){console.log(t.constructor.name)}};n.getCsvHeader=function(){return["Category","Commodity",n.CurrentLabel,n.PriorLabel,"Prior Revenue"]};n.getCsvData=function(){var i=[],e=[],r=0,u=0,f=0,t;return e=["Category","Commodity","CurrentExpense","PriorExpense","PriorRevenue"],angular.forEach(n.salesReportMaster,function(n){var t={};angular.forEach(n,function(n,i){var o=e.indexOf(i);o>-1&&(t[o]=i=="CurrentExpense"||i=="PriorExpense"||i=="PriorRevenue"?"$"+n:n);i=="CurrentExpense"&&(r=r+n);i=="PriorExpense"&&(u=u+n);i=="PriorRevenue"&&(f=f+n)});t!=undefined&&i.push(t)}),t={},t[0]="Total",t[1]="",t[2]="$"+r,t[3]="$"+u,t[4]="$"+f,i.push(t),i};h();n.checksamemonthdate=function(n,t){var i=new Date(n),r=new Date(t);return i.getMonth()==r.getMonth()?!1:!0}}]);