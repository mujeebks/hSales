MetronicApp.factory("authService",["dataService","localStorageService","$q","$rootScope",function(n,t,i,r){var f=function(f,e){var o=i.defer();return n.RequestToken(f,e).then(function(n){var i=n.data;t.set("nogalesAuth",{token:i.access_token,userName:i.userName,role:i.role,name:i.name});u.user.userName=i.userName;u.user.role=i.role;u.user.name=i.name;r.$broadcast("user_changed",{newUser:u.user});o.resolve(n.data)}).catch(function(){o.reject()}),o.promise},e=function(){u.user={userName:"",name:"",role:""};t.set("nogalesAuth",null);r.$broadcast("user_changed",{newUser:u.user})},o=function(t){var r=i.defer();return n.ResetPassword(t).then(function(n){r.resolve(n)}).catch(function(){r.reject()}),r.promise},s=function(t){var r=i.defer();return n.ChangePassword(t).then(function(n){r.resolve(n)}).catch(function(){r.reject()}),r.promise},h=function(){var n=t.get("nogalesAuth");n!=null&&n!=""?(u.user.userName=n.userName,u.user.role=n.role,u.user.name=n.name):(u.user.userName="",u.user.role="",u.user.name="")},c=function(){return u.user.userName==""?!1:!0},u={user:{userName:"",name:"",role:""},login:f,logout:e,resetPassword:o,updatePassword:s,fillAuthData:h,isAuthenticated:c};return u}]);