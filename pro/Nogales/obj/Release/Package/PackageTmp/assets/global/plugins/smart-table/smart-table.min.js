/** 
* @version 2.0.1
* @license MIT
*/
(function(n,t){"use strict";n.module("smart-table",[]).run(["$templateCache",function(n){n.put("template/smart-table/pagination.html",'<nav ng-if="pages.length >= 2"><ul class="pagination"><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}<\/a><\/li><\/ul><\/nav>')}]);n.module("smart-table").constant("stConfig",{pagination:{template:"template/smart-table/pagination.html",itemsByPage:10,displayedPages:5},search:{delay:400},select:{mode:"single",selectedClass:"st-selected"},sort:{ascentClass:"st-sort-ascent",descentClass:"st-sort-descent"}});n.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function(i,r,u,f){function p(n){return n?[].concat(n):[]}function w(){s=p(h(i));y===!0&&d.pipe()}function g(n,i){for(var e=[],o={},u=0;u<n.length;u++){var s=n[u],f=s[i],r=o[f];r===t&&(r={key:f,items:[]},o[f]=r,e.push(r));r.items.push(s)}return e}var b=f.stTable,a=r(b),k=a.assign,h,c=u("orderBy"),v=u("filter"),s=p(a(i)),e={sort:{},search:{},pagination:{start:0},group:{}},o,y=!0,d=this,l;f.stSafeSrc&&(h=r(f.stSafeSrc),i.$watch(function(){var n=h(i);return n?n.length:0},function(n){n!==s.length&&w()}),i.$watch(function(){return h(i)},function(n,t){n!==t&&w()}));this.sortBy=function(t,i,r){return e.sort.predicate=t,e.sort.reverse=i===!0,e.sort.isPercentage=r.isPercentage,e.sort.Numerator=r.Numerator,e.sort.Denominator=r.Denominator,n.isFunction(t)?e.sort.functionName=t.name:delete e.sort.functionName,e.pagination.start=0,this.pipe()};this.search=function(t,i){var r=e.search.predicateObject||{},u=i?i:"$";return t=n.isString(t)?t.trim():t,r[u]=t,t||delete r[u],e.search.predicateObject=r,e.pagination.start=0,this.pipe()};this.groupBy=function(n){return e.group.predicate=n?n:t,this.pipe()};this.pipe=function(){var n=e.pagination,r=e.group,u;o=e.search.predicateObject?v(s,e.search.predicateObject):s;e.sort.predicate&&r.predicate===t&&(o=c(o,e.sort.predicate,e.sort.reverse));r.predicate!==t&&(o=g(o,r.predicate));e.sort.predicate&&r.predicate!==t&&(o=c(o,function(n){var r,i,f,u,t;if(e.sort.isPercentage===!0){for(r=0,i=0,t=0;t<n.items.length;t++)r+=n.items[t][e.sort.Numerator],i+=n.items[t][e.sort.Denominator];return f=r/i*100,i==0?0:f}for(u=0,t=0;t<n.items.length;t++)u+=n.items[t][e.sort.predicate];return u},e.sort.reverse));n.number!==t&&(n.numberOfPages=o.length>0?Math.ceil(o.length/n.number):1,n.start=n.start>=o.length?(n.numberOfPages-1)*n.number:n.start,u=o.slice(n.start,n.start+parseInt(n.number)));k(i,u||o)};this.select=function(n,i){var r=s,u=r.indexOf(n);u!==-1&&(i==="single"?(n.isSelected=n.isSelected!==!0,l&&(l.isSelected=!1),l=n.isSelected===!0?n:t):r[u].isSelected=!r[u].isSelected)};this.slice=function(n,t){return e.pagination.start=n,e.pagination.number=t,this.pipe()};this.tableState=function(){return e};this.getFilteredCollection=function(){return o||s};this.setFilterFunction=function(n){v=u(n)};this.setSortFunction=function(n){c=u(n)};this.preventPipeOnWatch=function(){y=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(n,t,i,r){i.stSetFilter&&r.setFilterFunction(i.stSetFilter);i.stSetSort&&r.setSortFunction(i.stSetSort)}}});n.module("smart-table").directive("stSearch",["stConfig","$timeout",function(n,t){return{require:"^stTable",link:function(i,r,u,f){var o=f,e=null,s=u.stDelay||n.search.delay;u.$observe("stSearch",function(n,t){var i=r[0].value;n!==t&&i&&(f.tableState().search={},o.search(i,n))});i.$watch(function(){return f.tableState().search},function(n){var t=u.stSearch||"$";n.predicateObject&&n.predicateObject[t]!==r[0].value&&(r[0].value=n.predicateObject[t]||"")},!0);r.bind("input",function(n){n=n.originalEvent||n;e!==null&&t.cancel(e);e=t(function(){o.search(n.target.value,u.stSearch||"");e=null},s)})}}}]);n.module("smart-table").directive("stResetSearch",function(){return{restrict:"EA",require:"^stTable",scope:{tableFunctions:"="},link:function(n,t,i,r){n.tableFunctions={};n.tableFunctions.resetSearch=function(){var n;return n=r.tableState(),n.search.predicateObject={},n.pagination.start=0,r.pipe()}}}});n.module("smart-table").directive("stSelectRow",["stConfig",function(n){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(t,i,r,u){var f=r.stSelectMode||n.select.mode;i.bind("click",function(){t.$apply(function(){u.select(t.row,f)})});t.$watch("row.isSelected",function(t){t===!0?i.addClass(n.select.selectedClass):i.removeClass(n.select.selectedClass)})}}}]);n.module("smart-table").directive("stSort",["stConfig","$parse",function(i,r){return{restrict:"A",require:"^stTable",link:function(u,f,e,o){function p(){if(s++,h=n.isFunction(l(u))?l(u):e.stSort,s%3==0&&e.stSkipNatural===t)s=0,o.tableState().sort={},o.tableState().pagination.start=0,o.pipe();else{var i={},r=e.stSortPercentage!==t;r&&(i.Numerator=e.stSortPercentageNumerator,i.Denominator=e.stSortPercentageDenominator);i.isPercentage=r;o.sortBy(h,s%2==0,i)}}var h=e.stSort,l=r(h),s=0,a=e.stClassAscent||i.sort.ascentClass,v=e.stClassDescent||i.sort.descentClass,y=[a,v],c;e.stSortDefault&&(c=u.$eval(e.stSortDefault)!==t?u.$eval(e.stSortDefault):e.stSortDefault);f.bind("click",function(){h&&u.$apply(p)});c&&(s=c==="reverse"?1:0,p());u.$watch(function(){return o.tableState().sort},function(n){n.predicate!==h?(s=0,f.removeClass(a).removeClass(v)):(s=n.reverse===!0?2:1,f.removeClass(y[s%2]).addClass(y[s-1]))},!0)}}}]);n.module("smart-table").directive("stPagination",["stConfig",function(n){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(t,i){return i.stTemplate?i.stTemplate:n.pagination.template},link:function(t,i,r,u){function f(){var n=u.tableState().pagination,i=1,r,f,e=t.currentPage;for(t.currentPage=Math.floor(n.start/n.number)+1,i=Math.max(i,t.currentPage-Math.abs(Math.floor(t.stDisplayedPages/2))),r=i+t.stDisplayedPages,r>n.numberOfPages&&(r=n.numberOfPages+1,i=Math.max(1,r-t.stDisplayedPages)),t.pages=[],t.numPages=n.numberOfPages,f=i;f<r;f++)t.pages.push(f);e!==t.currentPage&&t.stPageChange({newPage:t.currentPage})}t.stItemsByPage=t.stItemsByPage?+t.stItemsByPage:n.pagination.itemsByPage;t.stDisplayedPages=t.stDisplayedPages?+t.stDisplayedPages:n.pagination.displayedPages;t.currentPage=1;t.pages=[];t.$watch(function(){return u.tableState().pagination},f,!0);t.$watch("stItemsByPage",function(n,i){n!==i&&t.selectPage(1)});t.$watch("stDisplayedPages",f);t.selectPage=function(n){n>0&&n<=t.numPages&&u.slice((n-1)*t.stItemsByPage,t.stItemsByPage)};t.$watch(function(){return u.getFilteredCollection()},function(n){n!=null&&(t.totalData=n.length)},!0);u.tableState().pagination.number||u.slice(0,t.stItemsByPage)}}}]);n.module("smart-table").directive("stPipe",function(){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(t,i,r,u){n.isFunction(t.stPipe)&&(u.preventPipeOnWatch(),u.pipe=function(){return t.stPipe(u.tableState(),u)})},post:function(n,t,i,r){r.pipe()}}}});n.module("smart-table").directive("stGroup",["stConfig","$parse",function(){return{restrict:"A",require:"^stTable",scope:{stGroup:"="},link:function(n,t,i,r){function f(){r.groupBy(u)}var u=n.stGroup;n.$watch("stGroup",function(){u=n.stGroup;f()})}}}])})(angular);